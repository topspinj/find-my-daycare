{% extends "base.html" %}

{% block content %}
<div class="home-container">
    <div class="home-header">
        <h1>Find My Daycare</h1>
        <p class="tagline">Discover licensed, age-appropriate daycares near you in Toronto.</p>
        <p class="trust-note">We only show licensed daycares. No ads. No rankings.</p>
    </div>

    <div class="search-card">
        {% if errors %}
        <div class="error-banner">
            <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="POST" action="/">
            <div class="form-group">
                <label for="address">Your address</label>
                <input type="text" id="address" name="address"
                       placeholder="e.g., 100 Queen St W, Toronto"
                       value="{{ address or '' }}" required>
                <p class="helper-text">We'll search within 5 km of your home</p>
            </div>

            <div class="form-group">
                <label for="birthday">Child's birthday</label>
                <input type="text" id="birthday" name="birthday"
                       placeholder="Select date"
                       value="{{ birthday or '' }}" required>
                <p class="helper-text">Can be a future date if expecting</p>
            </div>

            <div class="form-group">
                <label for="start_date">Requested start date</label>
                <input type="text" id="start_date" name="start_date"
                       placeholder="Select date"
                       value="{{ start_date or '' }}">
                <p class="helper-text">Defaults to today. We'll match age groups for this date.</p>
            </div>

            <button type="submit" class="btn-primary">Find daycares</button>
        </form>
    </div>
</div>

<script>
var fiveYearsAgo = new Date();
fiveYearsAgo.setFullYear(fiveYearsAgo.getFullYear() - 5);

var nineMonthsFromNow = new Date();
nineMonthsFromNow.setMonth(nineMonthsFromNow.getMonth() + 9);

var twoYearsFromNow = new Date();
twoYearsFromNow.setFullYear(twoYearsFromNow.getFullYear() + 2);

var startDatePicker = flatpickr("#start_date", {
    dateFormat: "Y-m-d",
    minDate: "today",
    maxDate: twoYearsFromNow,
    defaultDate: "{{ start_date or '' }}" || "today"
});

var birthdayPicker = flatpickr("#birthday", {
    dateFormat: "Y-m-d",
    minDate: fiveYearsAgo,
    maxDate: nineMonthsFromNow,
    defaultDate: "{{ birthday or '' }}",
    onChange: function(selectedDates) {
        if (selectedDates[0] && startDatePicker.selectedDates[0]) {
            if (selectedDates[0] > startDatePicker.selectedDates[0]) {
                alert("Birthday cannot be after the start date");
                birthdayPicker.clear();
            }
        }
    }
});

document.querySelector('form').addEventListener('submit', function(e) {
    var birthday = birthdayPicker.selectedDates[0];
    var startDate = startDatePicker.selectedDates[0] || new Date();
    if (birthday && birthday > startDate) {
        e.preventDefault();
        alert("Birthday cannot be after the start date");
    }
});
</script>
{% endblock %}
